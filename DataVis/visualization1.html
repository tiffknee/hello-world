<!DOCTYPE html>
<meta charset="utf-8">
<head>

<style>
body {
  font-family: "Helvetica", sans-serif;
  font-size: 12px;
}
.path {
  stroke-width: 1.5px;
  stroke-dasharray: 2,2;
  fill: none;
}
.line {
  stroke-width: 3px;
  stroke-opacity: 0.5;
  fill: none;
}
.axis path,
.axis line {
  stroke-width: 1px;
  stroke: #777;
  fill: none;
  shape-rendering: crispEdges;
}
</style>

<script src="https://d3js.org/d3.v4.min.js"></script>

</head>
<body>

  <div id="chart"></div>

<script>

var margin = {top: 45, right: 35, bottom: 45, left: 35},
  width = 900 - margin.left - margin.right,
  height = 600 - margin.top - margin.bottom;

var svg = d3.select("#chart").append("svg")
  .attr("width", (width + margin.left + margin.right)+"px")
  .attr("height", (height + margin.top + margin.bottom)+"px")
  .append('g')
  .attr("transform", "translate(" + margin.left + "," + margin.top + ")");


d3.json("dataset/test1_data.json", function(error, data){
  if (error) return console.error(error);
  //console.log(data);


var allSensors = ["FSR_1", "FSR_2", "FSR_3"]
//var allSensors = ["FSR_4", "FSR_5", "FSR_6"]


////Format data - array of arrays of {x, y} tuples
var dataReady = allSensors.map( function(sensorNum) {
  return {
    name: sensorNum,
    values: data.map(function(d) {
      return {time: d.time, humid: d.humidity, temp: d.temp, value: +d[sensorNum].resistance};
    })
  };
});
//console.log(dataReady)


var color = d3.scaleOrdinal()
  .domain(allSensors)
  .range(d3.schemeCategory10);


var xAxis = d3.scaleLinear()
  .domain(d3.extent(data, function(d) { return +d.time; }))
  .range([0, width]);
  svg.append("g")
  .attr("transform", "translate(0," + height + ")")
  .call(d3.axisBottom(xAxis).ticks(6))
  .append('text')
  .attr("x", width-35)
  .attr("y", 30)
  .attr("fill", "#777")
  .text("TIME IN SECONDS");

var yAxis = d3.scaleLinear()
  //.domain([0, d3.max(data[0].FSR_1, d => d.resistance)])
  //.domain([0, d3.max(data[0].humidity)])
  .domain([0, d3.max(dataReady, function(d) { return +d.values[1200].value; } ) ])
  //.domain([0, d3.max(dataReady, function(d) { return +d.value; } ) ])
  .range([height, 0]);
  svg.append("g")
  .call(d3.axisLeft(yAxis).ticks(5))
  .append('text')
  .attr("y", -25)
  .attr("transform", "rotate(-90)")
  .attr("fill", "#777")
  .text("FORCE IN NEWTONS");


////Add lines
var line = d3.line()
  .x(function(d) { return xAxis(+d.time) })
  .y(function(d) { return yAxis(+d.value) })
svg.selectAll("lines")
  .data(dataReady)
  .enter()
  .append("path")
  .attr("d", function(d){ return line(d.values) } )
  .attr("stroke", function(d){ return color(d.name) })
  .attr('class', 'path');


///Add a label at the end of each line
svg.selectAll("legend")
  .data(dataReady)
  .enter()
    .append('g')
    .append("text")
      .datum(function(d) { return {name: d.name, value: d.values[d.values.length - 1]}; }) // keep only last value of each time series
      .attr("transform", function(d) { return "translate(" + xAxis(d.value.time) + "," + yAxis(d.value.value) + ")"; }) // put at position of last point
      .attr("x", -6)
      .text(function(d) { return d.name; })
      .style("fill", function(d){ return color(d.name) });

// get the x and y values for least squares
var xSeries = data.map(function(d) { return parseFloat(+d.time); });
var ySeries = data.map(function(d) { return parseFloat(+d.value); });
    
console.log('xSeries: ' + xSeries);
console.log('ySeries: ' + ySeries);  

});

</script>

</body>
</html>